<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>2017400144: watchdog.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">2017400144
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">watchdog.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;bits/stdc++.h&gt;</code><br />
<code>#include &lt;cstdlib&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a78eea73fda7512d132976b396948060f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a78eea73fda7512d132976b396948060f">sigtermHandler</a> (int signo)</td></tr>
<tr class="separator:a78eea73fda7512d132976b396948060f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34ce9ab991790211060857b204607d1b"><td class="memItemLeft" align="right" valign="top">pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a34ce9ab991790211060857b204607d1b">forkfunc</a> (int <a class="el" href="process_8cpp.html#ad97b05b88ce9080f35b157cfacc8eb69">id</a>, string &amp;<a class="el" href="process_8cpp.html#ab8b997581f3073a2aa3afeb961b296b9">processpath</a>)</td></tr>
<tr class="separator:a34ce9ab991790211060857b204607d1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeff1ce7c51f5fbc59fa5d17c0ec45c3d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#aeff1ce7c51f5fbc59fa5d17c0ec45c3d">processRunner</a> (int &amp;<a class="el" href="watchdog_8cpp.html#a5141bb9a3176b8a4237ff89a31b49b4a">namedPipe</a>, int <a class="el" href="process_8cpp.html#ad97b05b88ce9080f35b157cfacc8eb69">id</a>, vector&lt; pid_t &gt; &amp;<a class="el" href="watchdog_8cpp.html#afd514f83a766a0b299d01d73dcfa8adc">pidlist</a>, string &amp;<a class="el" href="process_8cpp.html#ab8b997581f3073a2aa3afeb961b296b9">processpath</a>, fstream &amp;file)</td></tr>
<tr class="separator:aeff1ce7c51f5fbc59fa5d17c0ec45c3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5141bb9a3176b8a4237ff89a31b49b4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a5141bb9a3176b8a4237ff89a31b49b4a">namedPipe</a></td></tr>
<tr class="separator:a5141bb9a3176b8a4237ff89a31b49b4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7c47d39c81ab0a82a1618efda537865"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#ad7c47d39c81ab0a82a1618efda537865">watchdogfile</a></td></tr>
<tr class="separator:ad7c47d39c81ab0a82a1618efda537865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd514f83a766a0b299d01d73dcfa8adc"><td class="memItemLeft" align="right" valign="top">vector&lt; pid_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#afd514f83a766a0b299d01d73dcfa8adc">pidlist</a></td></tr>
<tr class="separator:afd514f83a766a0b299d01d73dcfa8adc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a34ce9ab991790211060857b204607d1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34ce9ab991790211060857b204607d1b">&#9670;&nbsp;</a></span>forkfunc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pid_t forkfunc </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string &amp;&#160;</td>
          <td class="paramname"><em>processpath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>for modularity purposes, there is a function for fork then exec. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>id of the process to be executed </td></tr>
    <tr><td class="paramname">processpath</td><td>path of the process' output file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>child's pid </dd></dl>
<p>variable s: string version of id</p>
<p>variable arg: char array version of id</p>
<p>variable procpath: char array version of process path</p>

</div>
</div>
<a id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>the main function that creates new processes by fork and loads the process by exec function. it calls processRunner whenever a new process is needed to start. It detects when a child is dead, if id 1 is dead, it kills all processes then restarts all, if anyone except for id 1 is dead, it just restarts the named process by calling processRunner function </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>number of arguments given </td></tr>
    <tr><td class="paramname">argv</td><td>array of given arguments </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 by default </dd></dl>
<p>variable N: number of processes to be created</p>
<p>variable processpath: path of process' output</p>
<p>variable watchdogpath: path of watchdog's output</p>
<p>variable file: fstream object to write to file</p>
<p>variable myfifo: pointer to the string of directory of pipe which is a fifo file</p>
<p>variable temp: char array to be written to the pipe</p>
<p>variable ind: index of char array</p>
<p>variable pid: pid of wathcdog</p>
<p>variable pidstr: string version of wathcdog's pid</p>
<p>variable deadpid: when a child dies watchdog detects it here, it gets the pid of dead child</p>
<p>variable deadid: id of the dead child</p>

</div>
</div>
<a id="aeff1ce7c51f5fbc59fa5d17c0ec45c3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeff1ce7c51f5fbc59fa5d17c0ec45c3d">&#9670;&nbsp;</a></span>processRunner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processRunner </td>
          <td>(</td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>namedPipe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vector&lt; pid_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>pidlist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string &amp;&#160;</td>
          <td class="paramname"><em>processpath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fstream &amp;&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>for modularity, there exists a function to start a process. It calls forkfunc function to fork and exec, it gets child's pid from forkfunc, refreshes pidlist and writes the id and pid of the new process to the named pipe </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">namedPipe</td><td>pipe's name </td></tr>
    <tr><td class="paramname">id</td><td>id of process that is to be restarted </td></tr>
    <tr><td class="paramname">pidlist</td><td>list of pids </td></tr>
    <tr><td class="paramname">processpath</td><td>path of process' output </td></tr>
    <tr><td class="paramname">file</td><td>watchdog output file, passed by reference </td></tr>
  </table>
  </dd>
</dl>
<p>variable cpid: child's pid that's returned by forkfunc</p>
<p>variable message: char array that is written to the pipe</p>

</div>
</div>
<a id="a78eea73fda7512d132976b396948060f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78eea73fda7512d132976b396948060f">&#9670;&nbsp;</a></span>sigtermHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sigtermHandler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>signo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>signal handler function, provides a graceful termination. For the bonus case, when watchdog receives SIGTERM or SIGINT signal it sends SIGTERM signal to all children and waits for their exit status so that no children is left orphan </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">signo</td><td>no of signal </td></tr>
  </table>
  </dd>
</dl>
<p>variable f: fstream object for the output</p>
<p>variable status: status of the dead children</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5141bb9a3176b8a4237ff89a31b49b4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5141bb9a3176b8a4237ff89a31b49b4a">&#9670;&nbsp;</a></span>namedPipe</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int namedPipe</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>named pipe's name </p>

</div>
</div>
<a id="afd514f83a766a0b299d01d73dcfa8adc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd514f83a766a0b299d01d73dcfa8adc">&#9670;&nbsp;</a></span>pidlist</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;pid_t&gt; pidlist</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>data structure for pids, index reflects id of the process. </p>

</div>
</div>
<a id="ad7c47d39c81ab0a82a1618efda537865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7c47d39c81ab0a82a1618efda537865">&#9670;&nbsp;</a></span>watchdogfile</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string watchdogfile</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>path of watchdog's output file </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
